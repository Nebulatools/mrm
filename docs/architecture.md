Architecture Document: HR KPI Dashboard
This document outlines the complete full-stack architecture for the HR KPI Dashboard, including backend systems, frontend implementation, and their integration. It serves as the single source of truth for AI-driven development, ensuring consistency across the entire technology stack. This unified approach combines what would traditionally be separate backend and frontend architecture documents, streamlining the development process.


1. High-Level Architecture
The architecture is a modern full-stack application using a 

serverless approach. The system consists of a Next.js frontend, a Supabase API layer, and a PostgreSQL database. Data ingestion is handled by Supabase Edge Functions.


Repository Structure: We will use a monorepo to share code, like TypeScript interfaces, between the frontend and backend.


Key Components: A Next.js frontend deployed on Vercel, with backend logic handled by Supabase Edge Functions and data stored in a PostgreSQL database.

Architecture Diagram:

Fragmento de código

graph TD
    A[End User] --> B(Web Browser)
    B --> C[Next.js Application]
    C --> D(Supabase API Gateway)
    D --> E[Supabase Services]
    E --> F[PostgreSQL Database]
    G[SFTP Server] --> H[Supabase Edge Function]
    H --> F
    I[Mock Data Service] --> F
    C -.-> |Frontend Data Fetching| D
    H -.-> |Data Ingestion and Processing| D
    style C fill:#FFE4B5,stroke:#333,stroke-width:2px;
    style E fill:#ADD8E6,stroke:#333,stroke-width:2px;
    style F fill:#ADD8E6,stroke:#333,stroke-width:2px;
    style G fill:#90EE90,stroke:#333,stroke-width:2px;
    style I fill:#ADD8E6,stroke:#333,stroke-width:2px;
2. Tech Stack
This is the definitive technology selection for the entire project. All development will use these exact versions.

Category	Technology	Version	Purpose	Rationale
Frontend Language	TypeScript	5.4+	Primary development language for the UI	Strong typing and tooling.
Frontend Framework	Next.js	14.x	The frontend framework	Handles routing and server-side rendering.
UI Component Library	Shadcn	^0.5.0	Provides a set of high-quality, pre-built UI components	Minimalist and customizable components.
State Management	React Hooks	18.x	Manages application state	A native and lightweight solution for component state.
Backend Logic	Supabase Edge Functions	1.x	Serverless functions for business logic	Used for backend logic and KPI calculations.
API Style	REST / GraphQL	-	The communication protocol	Supabase offers both options.
Database	PostgreSQL	13+	The relational database	A robust and scalable database provided by Supabase.
Hosting	Vercel	-	The hosting platform for the Next.js application	Tight integration with Next.js and serverless functions.
Authentication	Supabase Auth	-	Handles all user authentication	Built-in authentication, social logins, and secure session management.

Exportar a Hojas de cálculo
3. Data Models and Schema
This section outlines the concrete database schema using PostgreSQL syntax.

employees table: Combines employee information from the PRD's ACT and PLANTILLA models.

incidents table: Logs all employee-related incidents.

kpis table: Stores pre-calculated KPI values to optimize dashboard performance.

4. API Specification
We will use 

Supabase's built-in REST API as the primary communication protocol between the frontend and backend.

API Style: REST

Endpoints: The API will be auto-generated by Supabase based on our database schema, providing endpoints for our employees, incidents, and kpis tables.

5. Unified Project Structure
The monorepo structure will be organized as follows:

Plaintext

/hr-kpi-dashboard
├── apps/
│   ├── web/                    # The Next.js frontend application
│   └── functions/              # Supabase Edge Functions for backend logic
├── packages/
│   └── shared/                 # Shared code package (types, utils, etc.)
└── package.json                # Root package.json with workspaces
6. Infrastructure and Deployment
We will deploy to 

Vercel for the frontend and use Supabase for the backend. This setup aligns with the serverless architecture.


Deployment Strategy: A pull request will trigger an automated CI/CD pipeline in GitHub Actions. A successful build will deploy a preview environment on Vercel for the frontend and the Edge Functions to Supabase.

7. Security & Testing

Security Strategy: We'll implement a layered security approach using Supabase's built-in Authentication and Row Level Security (RLS). All data will be encrypted at rest and in transit via HTTPS.



Testing Strategy: We will use a test-after approach following the testing pyramid. This includes unit, integration, and end-to-end tests.

8. Coding Standards & Conventions

Consistency: File and folder names will use kebab-case (user-profile.tsx), while component names will use PascalCase (UserProfile).


Type Sharing: All shared types and interfaces will be stored in a dedicated package to prevent type mismatches.


API Interactions: All API calls must go through a dedicated service layer, with no direct API calls from components.













